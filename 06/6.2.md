# Каналы (каналы, буферизация, закрытие)

В Go **каналы** — это средство для **обмена данными между горутинами**. Они позволяют безопасно передавать значения из одной горутины в другую, избегая сложной синхронизации с mutex.

Каналы — основа **конкурентного программирования** в Go.

---

### Что такое канал

* Канал создаётся с помощью функции `make`:

```go
ch := make(chan int) // создаём канал для передачи int
```

* Оператор `<-` используется для **отправки и получения значений**:

```go
go func() {
    ch <- 42 // отправляем значение в канал
}()

value := <-ch // получаем значение из канала
fmt.Println(value) // 42
```

* Если канал пустой, чтение **блокируется**, пока не появится значение.
* Если канал заполнен, запись **блокируется**, пока кто-то не примет значение.

---

### Буферизированные каналы

* Канал можно сделать **буферизированным**, указав размер:

```go
ch := make(chan int, 2) // канал с буфером на 2 значения
```

* В буферизированном канале запись не блокируется, пока буфер не заполнен:

```go
ch <- 1
ch <- 2
// ch <- 3 // блокировка, буфер заполнен
```

* Чтение из буфера освобождает место для новых значений.

---

### Закрытие канала

* Канал можно закрыть с помощью `close`:

```go
close(ch)
```

* После закрытия:

  * Можно **читать до конца буфера**, затем будут возвращаться нулевые значения.
  * **Запись в закрытый канал вызывает panic**.

```go
for v := range ch { // range автоматически завершится после закрытия канала
    fmt.Println(v)
}
```

* Закрытие канала удобно, когда нужно **сообщить всем горутинам о завершении передачи данных**.

---

### Основные правила работы с каналами

1. **Передача данных через каналы безопасна для конкуренции** — не нужно вручную блокировать доступ.
2. **Закрывать канал должен только отправитель**, чтобы не возникло паники.
3. **Чтение из закрытого канала** безопасно, но возвращает нулевые значения, когда буфер пуст.
4. **Буферизация** позволяет писать и читать без мгновенной синхронизации, но блокировка всё равно возможна, если буфер заполнен или пуст.

---

### Итого

* **Канал** — это «трубопровод» для передачи данных между горутинами.
* Существует **буферизированные и небуферизированные каналы**.
* Каналы можно **закрывать**, чтобы сигнализировать о завершении передачи.
* Каналы делают конкурентное программирование в Go **простым и безопасным**, избавляя от сложной работы с mutex и блокировками.