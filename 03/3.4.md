# 3.4 WebAssembly –∏ TinyGo ‚≠ê

> WebAssembly (Wasm) ‚Äî –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏, –±–ª–∏–∑–∫–æ–π –∫ –Ω–∞—Ç–∏–≤–Ω–æ–π. Go –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Wasm —Å 1.11, –∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä TinyGo –¥–µ–ª–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ —Å–≤–µ—Ä—Ö–º–∞–ª–µ–Ω—å–∫–∏–º–∏.

## 1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º Go

```bash
GOOS=js GOARCH=wasm go build -o main.wasm
```

–í –∫–∞—Ç–∞–ª–æ–≥–µ –Ω—É–∂–µ–Ω `wasm_exec.js`:

```bash
cp $(go env GOROOT)/misc/wasm/wasm_exec.js .
```

### –ú–∏–Ω–∏-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ `index.html`
```html
<script src="wasm_exec.js"></script>
<script>
const go = new Go();
WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject)
  .then(r => go.run(r.instance));
</script>
```
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (`python -m http.server`) –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.

## 2. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å DOM
```go
package main
import (
    "syscall/js"
)
func main() {
    alert := js.Global().Get("alert")
    alert.Invoke("Hello from Go ‚ú®")
    select {} // –Ω–µ –¥–∞—ë–º main –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
}
```

## 3. TinyGo ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
```bash
brew install tinygo

tinygo build -o counter.wasm -target wasm ./counter.go
```
–†–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å ~2 MB –¥–æ <100 KB.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è TinyGo
- –ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª–Ω—ã—Ö –¥–∂–µ–Ω–µ—Ä–∏–∫–æ–≤, –æ—Ç—Ä–∞–∂–µ–Ω–∏—è (reflect) –∏ GC —É—Ä–µ–∑–∞–Ω.

## 4. wasm-—Ç–æ–¥–æ (–º–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç)
–í –ß–∞—Å—Ç–∏ 4 –º—ã —Å–¥–µ–ª–∞–µ–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ todo –Ω–∞ Wasm: —Ä–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–æ–∫, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `localStorage`, –æ–±—â–µ–Ω–∏–µ —Å Go-backend —á–µ—Ä–µ–∑ fetch.

## 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞
- **WASI**: –∑–∞–ø—É—Å–∫ Go-–º–æ–¥—É–ª–µ–π –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Ä–∞–Ω—Ç–∞–π–º–∞—Ö (Spin, Wasmtime).  
- **Plug-–∏–Ω –≤ NGINX** —á–µ—Ä–µ–∑ Wasm module.

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è üìù
1. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, –≤—ã–≤–æ–¥—è—â—É—é —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ `document.body`.  
2. –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –Ω–∞ TinyGo –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–∞–∑–º–µ—Ä `wasm`.  
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Wasm –≤ Node: `node --experimental-wasi-unstable-preview1` + –ø–∞–∫–µ—Ç `wasi`.
