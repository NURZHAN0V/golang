# 2.7 gRPC –∏ Protocol Buffers ‚≠ê

> gRPC ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π RPC –ø–æ–≤–µ—Ä—Ö HTTP/2 —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π Protocol Buffers.

## 1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
```bash
# protoc (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç)
brew install protobuf   # macOS, –∏–ª–∏ apt/yum

# Go-–ø–ª–∞–≥–∏–Ω—ã
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
export PATH="$PATH:$(go env GOPATH)/bin"
```

## 2. –ü–∏—à–µ–º `.proto`
`api/helloworld.proto`
```proto
syntax = "proto3";
package hello;
option go_package = "example.com/hello/api";

service Greeter {
    rpc SayHello (HelloRequest) returns (HelloReply);
}

message HelloRequest { string name = 1; }
message HelloReply   { string message = 1; }
```

## 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Go-–∫–æ–¥
```bash
protoc --go_out=. --go-grpc_out=. api/helloworld.proto
```

–°–æ–∑–¥–∞–¥—É—Ç—Å—è —Ñ–∞–π–ª—ã `helloworld.pb.go`, `helloworld_grpc.pb.go`.

## 4. –°–µ—Ä–≤–µ—Ä
```go
type server struct{ hello.UnimplementedGreeterServer }
func (s *server) SayHello(ctx context.Context, r *hello.HelloRequest) (*hello.HelloReply, error) {
    return &hello.HelloReply{Message: "Hello " + r.Name}, nil
}

func main() {
    lis, _ := net.Listen("tcp", ":50051")
    s := grpc.NewServer()
    hello.RegisterGreeterServer(s, &server{})
    slog.Info("grpc on :50051")
    s.Serve(lis)
}
```

## 5. –ö–ª–∏–µ–Ω—Ç
```go
conn, _ := grpc.Dial("localhost:50051", grpc.WithInsecure())
cli := hello.NewGreeterClient(conn)
resp, _ := cli.SayHello(context.Background(), &hello.HelloRequest{Name: "Go"})
fmt.Println(resp.Message)
```

## 6. gRPC-Gateway (REST + gRPC)
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `grpc-ecosystem/grpc-gateway/v2`, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTTP-handler, –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—â–∏–π JSON ‚Üî protobuf.

## 7. Buf (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ protoc)
`buf.build` –æ–±–ª–µ–≥—á–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º.

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è üìù
1. –î–æ–±–∞–≤—å—Ç–µ RPC `SayHelloAgain` c –ø–æ–ª–µ–º `times` ‚Äì —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–æ–ª—å–∫–æ —Ä–∞–∑.  
2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Swagger/OpenAPI —á–µ—Ä–µ–∑ `grpc-gateway` –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ Swagger UI.  
3. –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ TLS (—Å–º. `credentials.NewClientTLSFromCert`).
