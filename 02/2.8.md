# 2.8 –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `database/sql`, ORM, –º–∏–≥—Ä–∞—Ü–∏–∏

> Go –Ω–µ –Ω–∞–≤—è–∑—ã–≤–∞–µ—Ç ORM: –µ—Å—Ç—å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π `database/sql`, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º —Å—Ç—Ä–æ—è—Ç—Å—è sqlx, GORM, Ent.

## 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —á–µ—Ä–µ–∑ `database/sql`
```go
import (
    "database/sql"
    _ "github.com/lib/pq"
)

db, err := sql.Open("postgres", "postgres://user:pass@localhost/db?sslmode=disable")
if err != nil { log.Fatal(err) }
```
### –ó–∞–ø—Ä–æ—Å—ã
```go
row := db.QueryRow("SELECT name FROM users WHERE id=$1", 1)
var name string
row.Scan(&name)
```

## 2. `sqlx` ‚Äì —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–≤–µ—Ä—Ö `database/sql`
```bash
go get github.com/jmoiron/sqlx
```
```go
var u struct{ID int `db:"id"`; Name string `db:"name"`}
sx := sqlx.NewDb(db, "postgres")
_ = sx.Get(&u, "SELECT * FROM users WHERE id=$1", 1)
```

## 3. GORM ‚Äì –ø–æ–ø—É–ª—è—Ä–Ω—ã–π ORM
```bash
go get gorm.io/gorm gorm.io/driver/postgres
```
```go
db, _ := gorm.Open(postgres.Open(dsn), &gorm.Config{})

type Product struct { gorm.Model; Code string; Price int }

db.AutoMigrate(&Product{})
db.Create(&Product{Code: "P01", Price: 100})
```

## 4. –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å `golang-migrate`
```bash
go install github.com/golang-migrate/migrate/v4/cmd/migrate@latest
migrate -database $DSN -path migrations up
```
–§–∞–π–ª—ã: `0001_create_users.up.sql` / `.down.sql`.

## 5. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```go
tx, _ := db.Begin()
_, err := tx.Exec("UPDATE accounts SET bal = bal-100 WHERE id=1")
if err != nil { tx.Rollback(); return }
// ...
_ = tx.Commit()
```

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è üìù
1. –ü–æ–¥–Ω–∏–º–∏—Ç–µ PostgreSQL —á–µ—Ä–µ–∑ `docker run postgres`. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `notes(id serial, text text)` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –∏–∑ Go.  
2. –° –ø–æ–º–æ—â—å—é GORM —Å–¥–µ–ª–∞–π—Ç–µ –º–æ–¥–µ–ª—å `Book{Title, Year}` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏.  
3. –ù–∞–ø–∏—à–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é, –¥–æ–±–∞–≤–ª—è—é—â—É—é –∫–æ–ª–æ–Ω–∫—É `price` –≤ —Ç–∞–±–ª–∏—Ü—É `books` –∏ –æ—Ç–∫–∞—Ç–∏—Ç–µ –µ—ë.
