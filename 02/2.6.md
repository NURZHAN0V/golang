# 2.6 –°–µ—Ç—å: HTTP-–∫–ª–∏–µ–Ω—Ç, —Å–µ—Ä–≤–µ—Ä, REST, WebSocket

> –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç `net/http` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–Ω—è—Ç—å —Å–µ—Ä–≤–µ—Ä –∑–∞ 5 —Å—Ç—Ä–æ–∫ –∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ—á—Ç–∏ —Ç–∞–∫ –∂–µ –ø—Ä–æ—Å—Ç–æ.

## 1. HTTP-–∫–ª–∏–µ–Ω—Ç ‚Äì `http.Get`
```go
resp, err := http.Get("https://api.github.com")
if err != nil { log.Fatal(err) }
 defer resp.Body.Close()
fmt.Println("Status", resp.Status)
body, _ := io.ReadAll(resp.Body)
fmt.Println(string(body[:100]))
```
### –ö–∞—Å—Ç–æ–º–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º
```go
cli := &http.Client{Timeout: 5 * time.Second}
```

## 2. HTTP-—Å–µ—Ä–≤–µ—Ä ¬´Hello¬ª
```go
func hello(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintln(w, "Hello from Go")
}
func main() {
    http.HandleFunc("/", hello)
    log.Fatal(http.ListenAndServe(":8080", nil))
}
```
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ <http://localhost:8080>.

### Graceful shutdown
```go
srv := &http.Server{Addr: ":8080"}
go srv.ListenAndServe()
<-ctx.Done()
_ = srv.Shutdown(ctx)
```

## 3. REST-API c `chi`
```bash
go get github.com/go-chi/chi/v5
```
```go
r := chi.NewRouter()
r.Get("/users/{id}", getUser)
http.ListenAndServe(":8080", r)
```
`chi` –¥–∞—ë—Ç middleware, —Ä–æ—É—Ç–∏–Ω–≥ –ø–æ –º–µ—Ç–æ–¥–∞–º –∏ –ø–∞—Ç—Ç–µ—Ä–∞–º.

## 4. WebSocket (Gorilla)
```bash
go get github.com/gorilla/websocket
```
```go
var upgrader = websocket.Upgrader{}
func ws(w http.ResponseWriter, r *http.Request) {
    c, _ := upgrader.Upgrade(w, r, nil)
    defer c.Close()
    for {
        _, msg, err := c.ReadMessage()
        if err != nil { break }
        c.WriteMessage(websocket.TextMessage, msg) // echo
    }
}
```

## 5. Middleware –ø—Ä–∏–º–µ—Ä (–ª–æ–≥ –∑–∞–ø—Ä–æ—Å–æ–≤)
```go
func logger(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        t := time.Now()
        next.ServeHTTP(w, r)
        slog.Info("req", "method", r.Method, "url", r.URL.Path, "dur", time.Since(t))
    })
}
```

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è üìù
1. –ù–∞–ø–∏—à–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ `GET /ping` –æ—Ç–≤–µ—á–∞–µ—Ç JSON `{ "message": "pong" }`.  
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —ç—Ö–æ-WebSocket –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –Ω–µ–º—É `wscat -c ws://localhost:8080/ws`.  
3. –ò—Å–ø–æ–ª—å–∑—É—è `http.Client`, —Å–∫–∞—á–∞–π—Ç–µ HTML –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã golang.org –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª.
