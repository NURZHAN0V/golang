# Буферизация и Scanner

При работе с файлами или потоками данных важно **эффективно читать и записывать информацию**. Go предлагает для этого пакет **`bufio`**, который обеспечивает **буферизацию**, а также удобный тип **`Scanner`** для построчного чтения.

---

### Буферизация: зачем она нужна

* Буферизация **сокращает количество системных вызовов**, повышая производительность.
* Вместо чтения или записи **по одному байту**, данные накапливаются в памяти и обрабатываются блоками.
* В Go есть два основных инструмента:

1. **`bufio.Reader`** — для чтения.
2. **`bufio.Writer`** — для записи.

---

### Чтение с bufio.Reader

```go
file, err := os.Open("example.txt")
if err != nil {
    fmt.Println(err)
    return
}
defer file.Close()

reader := bufio.NewReader(file)
line, err := reader.ReadString('\n') // читаем до конца строки
if err != nil && err != io.EOF {
    fmt.Println(err)
}
fmt.Println(line)
```

* `ReadString('\n')` возвращает **строку до символа перевода строки**.
* Для больших файлов **читает порциями**, не загружая весь файл в память.

---

### Построчное чтение с Scanner

```go
file, _ := os.Open("example.txt")
defer file.Close()

scanner := bufio.NewScanner(file)
for scanner.Scan() {
    fmt.Println(scanner.Text()) // вывод каждой строки
}

if err := scanner.Err(); err != nil {
    fmt.Println("Ошибка сканера:", err)
}
```

* **Scanner** удобен для **обработки текста построчно**.
* Можно легко фильтровать строки, например, пропускать пустые или искать ключевые слова.

---

### Буферизация при записи

```go
file, _ := os.Create("output.txt")
defer file.Close()

writer := bufio.NewWriter(file)
writer.WriteString("Первая строка\n")
writer.WriteString("Вторая строка\n")
writer.Flush() // обязательно сбрасываем буфер на диск
```

* **Flush()** отправляет накопленные данные на диск.
* Без вызова `Flush()` часть данных может остаться в буфере и **не записаться в файл**.

---

### Преимущества bufio и Scanner

* Экономия ресурсов при работе с **большими файлами**.
* Удобство **построчной обработки текста**.
* Возможность **работать с потоками данных** (stdin, сети, сокеты) точно так же, как с файлами.

---

### Итого

* **Буферизация** повышает производительность при чтении и записи.
* **Scanner** облегчает работу с построчными данными.
* Всегда **используйте `defer file.Close()` и `writer.Flush()`**, чтобы данные корректно сохранялись и ресурсы освобождались.