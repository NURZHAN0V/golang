# ORM: GORM, Ent

При работе с базами данных на Go можно использовать **чистый SQL** через пакет `database/sql`.
Но в крупных проектах часто применяют **ORM (Object-Relational Mapping)** — библиотеку, которая связывает структуры Go с таблицами базы данных.
Это позволяет писать меньше SQL-запросов вручную и работать с БД более «по-Go-шному».

Наиболее популярные ORM для Go: **GORM** и **Ent**.

---

### GORM

[GORM](https://gorm.io) — самая известная ORM для Go.
Она предоставляет удобный API для работы с моделями, связями и миграциями.

Установка:

```bash
go get gorm.io/gorm
go get gorm.io/driver/postgres   # драйвер PostgreSQL
```

Пример подключения и миграции:

```go
import (
    "gorm.io/driver/postgres"
    "gorm.io/gorm"
)

type User struct {
    ID    uint   `gorm:"primaryKey"`
    Name  string
    Email string
}

dsn := "host=localhost user=postgres password=1234 dbname=test port=5432 sslmode=disable"
db, err := gorm.Open(postgres.Open(dsn), &gorm.Config{})
if err != nil {
    panic(err)
}

// Автоматическая миграция
db.AutoMigrate(&User{})

// Создание записи
db.Create(&User{Name: "Alice", Email: "alice@example.com"})
```

**Особенности GORM:**

* поддержка всех популярных СУБД,
* авто-миграции и связи (One-To-Many, Many-To-Many и т.д.),
* огромная комьюнити и документация,
* немного «магии», из-за чего новичкам может быть трудно отлаживать.

---

### Ent

[Ent](https://entgo.io) — ORM от Facebook (Meta).
В отличие от GORM, он **генерирует код** моделей и запросов на основе схемы.
Это даёт статическую типизацию и меньше ошибок в рантайме.

Установка:

```bash
go get entgo.io/ent/cmd/ent
```

Создание схемы (например, для `User`):

```bash
go run entgo.io/ent/cmd/ent init User
```

Файл схемы `ent/schema/user.go`:

```go
package schema

import (
    "entgo.io/ent"
    "entgo.io/ent/schema/field"
)

type User struct {
    ent.Schema
}

func (User) Fields() []ent.Field {
    return []ent.Field{
        field.String("name"),
        field.String("email"),
    }
}
```

Генерация кода:

```bash
go generate ./ent
```

Использование:

```go
client, err := ent.Open("postgres", "host=localhost user=postgres password=1234 dbname=test sslmode=disable")
if err != nil {
    panic(err)
}
defer client.Close()

ctx := context.Background()
user, err := client.User.
    Create().
    SetName("Bob").
    SetEmail("bob@example.com").
    Save(ctx)
```

**Особенности Ent:**

* строгая типизация (ошибки заметны ещё при компиляции),
* генерация кода, минимизация «магии»,
* удобство для больших проектов,
* чуть более высокий порог входа, чем у GORM.

---

### Итого

* **GORM** — удобная, популярная и «магическая» ORM, с быстрым стартом. Отличный выбор для большинства приложений.
* **Ent** — строгая, типобезопасная ORM с генерацией кода. Лучше для больших и долгосрочных проектов.
* Оба варианта работают поверх `database/sql` и поддерживают основные СУБД.