# Миграции

Когда проект растёт, схема базы данных меняется:
нужно добавлять таблицы, новые поля, индексы.
Если просто менять структуру руками — легко запутаться.

Для этого используют **миграции** — специальные скрипты, которые пошагово изменяют схему БД.
Такой подход позволяет:

* хранить историю изменений,
* быстро откатывать ошибки,
* синхронизировать БД у всей команды и на продакшене.

---

### Популярные инструменты

В Go чаще всего используют:

* **[golang-migrate](https://github.com/golang-migrate/migrate)** — простой и надёжный CLI-инструмент,
* **[goose](https://github.com/pressly/goose)** — удобный инструмент, поддерживает SQL и Go-файлы,
* встроенные возможности в ORM (например, GORM `AutoMigrate`), но они подходят только для простых случаев.

---

### Пример: golang-migrate

Установка:

```bash
go install github.com/golang-migrate/migrate/v4/cmd/migrate@latest
```

Создание миграции:

```bash
migrate create -ext sql -dir migrations create_users_table
```

Это создаст два файла:

```
migrations/
  20250928153045_create_users_table.up.sql
  20250928153045_create_users_table.down.sql
```

Пример содержимого `up.sql`:

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL
);
```

Файл `down.sql` (откат):

```sql
DROP TABLE users;
```

Применение миграций:

```bash
migrate -path migrations -database "postgres://user:pass@localhost:5432/db?sslmode=disable" up
```

Откат:

```bash
migrate down
```

---

### Пример: goose

Установка:

```bash
go install github.com/pressly/goose/v3/cmd/goose@latest
```

Создание миграции:

```bash
goose create create_users_table sql
```

Применение миграций:

```bash
goose postgres "user=postgres dbname=test sslmode=disable" up
```

Откат:

```bash
goose down
```

---

### Итого

* **Миграции** нужны для контроля схемы базы данных и командной работы.
* **golang-migrate** — минималистичный и надёжный вариант.
* **goose** — гибкий инструмент, поддерживает миграции на Go.
* ORM (например, GORM `AutoMigrate`) подходят для прототипов, но для продакшена лучше явные миграции.