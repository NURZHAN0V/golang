# WebSocket  

WebSocket — это протокол для **двусторонней связи между клиентом и сервером**, который работает поверх TCP. Он позволяет обмениваться данными **в реальном времени**, без постоянных HTTP-запросов.  

Go отлично подходит для работы с WebSocket благодаря своей **легковесной конкурентности** и поддержке библиотек, таких как **gorilla/websocket**.  

---

### Подключение библиотеки  

```bash
go get github.com/gorilla/websocket
```

- `gorilla/websocket` — популярная библиотека для работы с WebSocket в Go.  
- Она предоставляет удобные функции для **чтения и записи сообщений**.  

---

### Простейший сервер WebSocket  

```go
package main

import (
    "fmt"
    "net/http"

    "github.com/gorilla/websocket"
)

var upgrader = websocket.Upgrader{}

func wsHandler(w http.ResponseWriter, r *http.Request) {
    conn, err := upgrader.Upgrade(w, r, nil)
    if err != nil {
        fmt.Println("Ошибка апгрейда:", err)
        return
    }
    defer conn.Close()

    for {
        messageType, message, err := conn.ReadMessage()
        if err != nil {
            fmt.Println("Ошибка чтения:", err)
            break
        }
        fmt.Printf("Получено: %s\n", message)

        err = conn.WriteMessage(messageType, message)
        if err != nil {
            fmt.Println("Ошибка записи:", err)
            break
        }
    }
}

func main() {
    http.HandleFunc("/ws", wsHandler)
    fmt.Println("WebSocket сервер запущен на http://localhost:8080/ws")
    http.ListenAndServe(":8080", nil)
}
```

- `websocket.Upgrader` преобразует обычное HTTP-соединение в WebSocket.  
- `ReadMessage` считывает сообщения от клиента, `WriteMessage` — отправляет их обратно.  
- В данном примере сервер просто **эха**: отправляет клиенту то же сообщение, которое получил.  

---

### Настройка безопасности  

```go
var upgrader = websocket.Upgrader{
    CheckOrigin: func(r *http.Request) bool {
        return true // для теста разрешаем любые подключения
    },
}
```

- По умолчанию WebSocket **блокирует подключения с другого источника**.  
- `CheckOrigin` позволяет настроить **политику CORS** для WebSocket.  

---

### Клиент на Go  

```go
package main

import (
    "fmt"
    "log"
    "github.com/gorilla/websocket"
)

func main() {
    conn, _, err := websocket.DefaultDialer.Dial("ws://localhost:8080/ws", nil)
    if err != nil {
        log.Fatal("Ошибка подключения:", err)
    }
    defer conn.Close()

    err = conn.WriteMessage(websocket.TextMessage, []byte("Привет, сервер!"))
    if err != nil {
        log.Println("Ошибка отправки:", err)
    }

    _, message, err := conn.ReadMessage()
    if err != nil {
        log.Println("Ошибка чтения:", err)
    }
    fmt.Printf("Ответ сервера: %s\n", message)
}
```

- `DefaultDialer.Dial` создаёт соединение с сервером.  
- Клиент может **отправлять и получать сообщения** так же, как сервер.  

---

### Итого  

- WebSocket позволяет строить **реактивные приложения в реальном времени**, чаты, игры и уведомления.  
- В Go WebSocket легко реализовать с библиотекой **gorilla/websocket**.  
- Сервер может обслуживать множество клиентов одновременно, используя **горутины**.  
- Не забывай о **CORS и безопасности** при работе с WebSocket в веб-приложениях. 