# 1.5 –§—É–Ω–∫—Ü–∏–∏, `defer`, `panic`, `recover`

> –§—É–Ω–∫—Ü–∏—è ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –±–ª–æ–∫ –∫–æ–¥–∞. –í Go –æ–Ω–∏ –æ–±—ä—è–≤–ª—è—é—Ç—Å—è —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º `func` –∏ –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π.

## 1. –°–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ—É–Ω–∫—Ü–∏–∏
```go
func add(a int, b int) int {
    return a + b
}
```
- –¢–∏–ø —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ** –∏–º–µ–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.  
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å:
```go
func multiply(a, b int) int { return a * b }
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
```go
func divRem(a, b int) (int, int) {
    q := a / b
    r := a % b
    return q, r
}
q, r := divRem(10, 3) // 3 1
```

### –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```go
func area(w, h float64) (a float64) {
    a = w * h // –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –±–µ–∑ return a
    return       // –ø—É—Å—Ç–æ–π return –≤–µ—Ä–Ω—ë—Ç —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
}
```

## 2. `defer` ‚Äî ¬´—Å–¥–µ–ª–∞–π –ø–æ–∑–∂–µ¬ª
`defer` –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤ –¥–æ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ (—É—Å–ø–µ—à–Ω–æ–≥–æ –∏–ª–∏ –∏–∑-–∑–∞ –ø–∞–Ω–∏–∫–∏).
```go
func readFile() {
    f, _ := os.Open("data.txt")
    defer f.Close() // –∑–∞–∫—Ä–æ–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ
    // —Ä–∞–±–æ—Ç–∞–µ–º —Å —Ñ–∞–π–ª–æ–º...
}
```
Defer-–≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ** (—Å—Ç–µ–∫).

## 3. `panic` –∏ `recover`
`panic` –∞–≥–µ–Ω—Ç –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –≤—ã–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã ‚Äî –∞–Ω–∞–ª–æ–≥ throw.  
`recover` –ª–æ–≤–∏—Ç –ø–∞–Ω–∏–∫—É, –µ—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ defer.

```go
func safeDivide(a, b int) (res int, ok bool) {
    defer func() {
        if r := recover(); r != nil {
            fmt.Println("catch panic:", r)
            ok = false
        }
    }()
    if b == 0 {
        panic("division by zero")
    }
    return a / b, true
}
```

## 4. –§—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –∞–Ω–æ–Ω–∏–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```go
op := func(x, y int) int { return x + y }
fmt.Println(op(2, 3)) // 5
```
–§—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –¥—Ä—É–≥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:
```go
func apply(f func(int, int) int, a, b int) int {
    return f(a, b)
}
apply(op, 4, 5) // 9
```

## 5. –ó–∞–º—ã–∫–∞–Ω–∏—è (closures)
```go
func counter() func() int {
    n := 0
    return func() int {
        n++
        return n
    }
}
next := counter()
fmt.Println(next()) // 1
fmt.Println(next()) // 2
```
–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è ¬´–ø–æ–º–Ω–∏—Ç¬ª –∑–Ω–∞—á–µ–Ω–∏–µ `n` –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏.

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è üìù
1. –ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `max(a, b int) int`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é –±–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ.  
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ `fib(n int) int` —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `defer` –¥–ª—è –ø–µ—á–∞—Ç–∏ ¬´–∑–∞–∫–æ–Ω—á–∏–ª–∏¬ª –ø–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è.  
3. –°–æ–∑–¥–∞–π—Ç–µ —Å—á—ë—Ç—á–∏–∫-–∑–∞–º—ã–∫–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä—ã–π –∫–∞–∂–¥–æ–µ –≤—ã–∑–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ —á—ë—Ç–Ω–æ–µ —á–∏—Å–ª–æ (2, 4, 6‚Ä¶).

<details><summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ –∫ ‚Ññ2</summary>
```go
func fib(n int) int {
    if n <= 1 {
        return n
    }
    return fib(n-1) + fib(n-2)
}
```
</details>
