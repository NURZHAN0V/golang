# –ü—Ä–æ–µ–∫—Ç üî¨ wasm-todo –≤ –±—Ä–∞—É–∑–µ—Ä–µ

> –°–¥–µ–ª–∞–µ–º –æ–¥–Ω–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ¬´–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á¬ª –Ω–∞ —á–∏—Å—Ç–æ–º Go, –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º–æ–º –≤ WebAssembly. –ë–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ ‚Äì —Ç–æ–ª—å–∫–æ `syscall/js`.

## 1. –ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–µ–∫—Ç–∞
```
wasm-todo/
 ‚îú‚îÄ main.go          # –ª–æ–≥–∏–∫–∞
 ‚îú‚îÄ index.html       # –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π HTML
 ‚îú‚îÄ style.css        # —Å—Ç–∏–ª–∏
 ‚îî‚îÄ Makefile
```

## 2. main.go
```go
package main
import (
    "syscall/js"
)

type Todo struct{ Text string; Done bool }
var todos []Todo

func render() {
    doc := js.Global().Get("document")
    list := doc.Call("getElementById", "list")
    list.Set("innerHTML", "")
    for i, t := range todos {
        li := doc.Call("createElement", "li")
        li.Set("textContent", t.Text)
        if t.Done { li.Get("classList").Call("add", "done") }
        idx := i // –∫–æ–ø–∏—è –¥–ª—è –∑–∞–º—ã–∫–∞–Ω–∏—è
        li.Call("addEventListener", "click", js.FuncOf(func(this js.Value, args []js.Value) any {
            todos[idx].Done = !todos[idx].Done
            render(); return nil
        }))
        list.Call("appendChild", li)
    }
}

func add(this js.Value, args []js.Value) any {
    input := js.Global().Get("document").Call("getElementById", "task")
    text := input.Get("value").String()
    if text != "" {
        todos = append(todos, Todo{Text: text})
        input.Set("value", "")
        render()
    }
    return nil
}

func main() {
    js.Global().Get("document").Call("getElementById", "add").Call("addEventListener", "click", js.FuncOf(add))
    render()
    select {} // –¥–µ—Ä–∂–∏–º –≥–æ—Ä—É—Ç–∏–Ω—É
}
```

## 3. index.html
```html
<!doctype html>
<html><head>
<meta charset="utf-8"><title>Todo WASM</title>
<link rel="stylesheet" href="style.css">
<script src="wasm_exec.js"></script>
</head><body>
<h1>Todo</h1>
<input id="task" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞"><button id="add">–î–æ–±–∞–≤–∏—Ç—å</button>
<ul id="list"></ul>
<script>
const go = new Go();
WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject)
  .then(r => go.run(r.instance));
</script>
</body></html>
```

## 4. –°–±–æ—Ä–∫–∞ —Å Makefile
```make
wasm:
	GOOS=js GOARCH=wasm go build -o main.wasm .
	cp $(shell go env GOROOT)/misc/wasm/wasm_exec.js .
serve:
	python -m http.server 8080
```

```bash
make wasm && make serve
```
–û—Ç–∫—Ä–æ–π—Ç–µ <http://localhost:8080> ‚Äì —Ä–∞–±–æ—Ç–∞–µ—Ç!

## 5. –£–ª—É—á—à–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ `localStorage` —á–µ—Ä–µ–∑ `js.Global().Get("localStorage")`.  
- –§–∏–ª—å—Ç—Ä—ã ¬´–≤—Å–µ / –∞–∫—Ç–∏–≤–Ω—ã–µ / –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ¬ª.  
- –ü–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—è —Å TinyGo –¥–ª—è –º–µ–Ω—å—à–µ–≥–æ –≤–µ—Å–∞.

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è üìù
1. –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–û—á–∏—Å—Ç–∏—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ¬ª.  
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ `tailwind.css` –¥–ª—è —Å—Ç–∏–ª–µ–π (—á–µ—Ä–µ–∑ CDN).  
3. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∏–∑–º–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä wasm: –æ–±—ã—á–Ω—ã–π Go vs TinyGo.
