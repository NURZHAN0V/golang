# –ü—Ä–æ–µ–∫—Ç üî¨ URL-shortener REST + PostgreSQL

## –ó–∞–¥–∞—á–∞
–°–µ—Ä–≤–∏—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–ª–∏–Ω–Ω—ã–π URL, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ –Ω–µ–º—É. –ü–æ–∫—Ä–æ–µ–º: chi-router, sqlc, migrations, Docker-compose.

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
shortener/
 ‚îú‚îÄ cmd/api/main.go
 ‚îú‚îÄ internal/handler/http.go
 ‚îú‚îÄ internal/repo/query.sql
 ‚îú‚îÄ migrations/0001_init.up.sql
 ‚îú‚îÄ docker-compose.yml
 ‚îî‚îÄ go.mod
```

## 2. –ú–∏–≥—Ä–∞—Ü–∏–∏
`migrations/0001_init.up.sql`
```sql
CREATE TABLE links (
 id SERIAL PRIMARY KEY,
 code TEXT UNIQUE NOT NULL,
 original TEXT NOT NULL,
 created_at TIMESTAMP DEFAULT now()
);
```

## 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Go-–∫–æ–¥ sqlc
`sqlc.yaml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `internal/repo`.
```bash
sqlc generate
```
–ü–æ–ª—É—á–∏–º `Querier` —Å –º–µ—Ç–æ–¥–∞–º–∏ `CreateLink`, `GetLink`.

## 4. HTTP-handler
```go
func shorten(w http.ResponseWriter, r *http.Request) {
 var req struct{URL string}
 json.NewDecoder(r.Body).Decode(&req)
 code := randString(6)
 repo.CreateLink(ctx, repo.CreateLinkParams{Code: code, Original: req.URL})
 json.NewEncoder(w).Encode(map[string]string{"code": code})
}

func redirect(w http.ResponseWriter, r *http.Request) {
 code := chi.URLParam(r, "code")
 l, err := repo.GetLink(ctx, code)
 if err != nil { http.NotFound(w,r); return }
 http.Redirect(w, r, l.Original, http.StatusFound)
}
```

## 5. Compose
```yaml
version: "3"
services:
  db:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: pass
    ports: ["5433:5432"]
  api:
    build: .
    environment:
      DB_DSN: postgres://postgres:pass@db/short?sslmode=disable
    ports: ["8080:8080"]
```

## 6. –¢–µ—Å—Ç—ã
–§–∞–π–ª `_test.go` –ø–æ–¥–Ω–∏–º–∞–µ—Ç TestContainer postgres, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏, —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç `CreateLink/GetLink`.

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è üìù
1. –†–µ–∞–ª–∏–∑—É–π—Ç–µ TTL: —Å—Å—ã–ª–∫–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π —É–¥–∞–ª—è—é—Ç—Å—è –∫—Ä–æ–Ω–æ–º.  
2. –î–æ–±–∞–≤—å—Ç–µ rate-limit 50 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω –Ω–∞ IP (middleware).  
3. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ OpenAPI —á–µ—Ä–µ–∑ `chi-middleware-openapi` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ Swagger UI.
