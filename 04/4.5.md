# Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ ðŸ”¬ ÐœÐ¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ½Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€ (Auth + Billing + API-Gateway)

## Ð¦ÐµÐ»ÑŒ
Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸-Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚ Ð¸Ð· Ñ‚Ñ€Ñ‘Ñ… Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð², ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ñ… gRPC + REST-gateway, Ñ Ð¿Ð¾Ð»Ð½Ñ‹Ð¼ Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸ÐµÐ¼, CI/CD Ð¸ Docker-Compose.

## 1. Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹
| Ð˜Ð¼Ñ | ÐŸÐ¾Ñ€Ñ‚ | ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ |
|-----|------|-----------------|
| auth-svc    | 50051 | Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ, JWT-Ð»Ð¾Ð³Ð¸Ð½ |
| billing-svc | 50052 | ÐºÐ¾ÑˆÐµÐ»Ñ‘Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ |
| gateway     | 8080  | REST â†” gRPC proxy, ÑÑ‚Ð°Ñ‚Ð¸Ñ‡Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ |

## 2. Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸
* gRPC + protobuf + buf.  
* PostgreSQL Ð´Ð»Ñ auth, billing.  
* Redis Ð´Ð»Ñ ÑÐµÑÑÐ¸Ð¹.  
* OpenTelemetry â†’ Jaeger, Prometheus, Grafana.  
* JWT auth, middleware Ð½Ð° gateway.  
* CI: GitHub Actions â†’ docker push â†’ deploy Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ñ‡ÐµÑ€ÐµÐ· docker-compose.

## 3. Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹
```
project/
 â”œâ”€ proto/             # *.proto ÑÑ…ÐµÐ¼Ñ‹
 â”œâ”€ auth-svc/
 â”‚    â”œâ”€ cmd/server/main.go
 â”‚    â”œâ”€ internal/..
 â”œâ”€ billing-svc/
 â”‚    â””â”€ ...
 â”œâ”€ gateway/
 â”‚    â””â”€ ...
 â”œâ”€ deploy/docker-compose.yml
 â””â”€ go.work
```
ÐœÐ¾Ð´ÑƒÐ»Ð¸ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ñ‹ Ñ‡ÐµÑ€ÐµÐ· `go work`.

## 4. Auth-service ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹
* `/Register` â€“ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, Ñ…ÑÑˆÐ¸Ñ‚ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ `bcrypt`.  
* `/Login` â€“ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ Ð²Ñ‹Ð´Ð°Ñ‡Ð° `access`+`refresh` JWT.  
* ÐŸÑƒÐ±Ð»Ð¸ÐºÑƒÐµÑ‚ Prometheus Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ `auth_register_total`.

## 5. Billing-service
* Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° `transactions` (id, user_id, amount, ts).  
* Method `Charge(user, amt)` Ñ Ð¸Ð´ÐµÐ¼Ð¿Ð¾Ñ‚ÐµÐ½Ñ‚Ð½Ñ‹Ð¼ ÐºÐ»ÑŽÑ‡Ð¾Ð¼.  
* Emits OTEL trace span `billing.charge`.

## 6. Gateway
* gRPC-gateway Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ (`grpc-ecosystem/grpc-gateway/v2`).  
* Middleware Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ°: recover â†’ cors â†’ logger â†’ auth(JWT verify) â†’ handler.  
* Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡Ð½Ñ‹Ðµ React-Ñ„Ð°Ð¹Ð»Ñ‹ Ñ€Ð°Ð·Ð´Ð°ÑŽÑ‚ÑÑ Ñ `/app/*` (build Ð½Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½).

## 7. Observability stack (compose)
```
prometheus:
  image: prom/prometheus
jaeger:
  image: jaegertracing/all-in-one
loki:
  image: grafana/loki
```
Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹ Ð¿Ð¸ÑˆÑƒÑ‚ logs Ð² stdout JSON, ÑÐ¾Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Loki-driverÐ¾Ð¼.

## 8. CI/CD ÐºÑ€Ð°Ñ‚ÐºÐ¾
1. Job `test` â€“ `go test ./... -race`.  
2. Job `docker` â€“ buildx matrix (auth, billing, gateway).  
3. Job `deploy` â€“ `docker compose pull && docker compose up -d` Ñ‡ÐµÑ€ÐµÐ· SSH-runner.

## 9. Roadmap ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹
- k8s Helm-Ñ‡Ð°Ñ€Ñ‚Ñ‹.  
- Saga-Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ Ð¼ÐµÐ¶Ð´Ñƒ ÑÐµÑ€Ð²Ð¸ÑÐ°Ð¼Ð¸.  
- Rate-limit per-user Ð² gateway.  
- GraphQL-ÑˆÐ»ÑŽÐ· Ð¿Ð¾Ð²ÐµÑ€Ñ… gRPC.

## Ð—Ð°Ð´Ð°Ð½Ð¸Ñ Ð´Ð»Ñ Ñ‡Ð¸Ñ‚Ð°Ñ‚ÐµÐ»Ñ ðŸ“
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÐµÑ€Ð²Ð¸Ñ `email-svc`, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‰Ð¸Ð¹ Ð¿Ð¸ÑÑŒÐ¼Ð° Ñ‡ÐµÑ€ÐµÐ· SMTP mock, Ð¸ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÐµÐ³Ð¾ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸.  
2. Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐ¹Ñ‚Ðµ refund Ð² billing-svc Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¾Ð¹ Ð´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ° ÑÑ€ÐµÐ´ÑÑ‚Ð².  
3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ alert Ð² Prometheus: `billing_charge_error_rate > 5%`.
